# BTU Template Flow Visualizer

**BTU Template Flow Visualizer** 是一个基于 `Vue 3`, `Vite` 和 `VueFlow` 开发的高交互性图形界面应用。此项目专用于设计和维护农业领域的 **BTU（具体业务单元）种植模板配置链路**，允许业务人员或管理员直观地以流程图的形式定义生育期、农事操作节点、规则节点之间的一系列执行和约束依赖。

## ✨ 核心特性

- **可视化流程配置模型** 
  借助 [VueFlow](https://vueflow.dev/) 的高性能画布以及节点、连线构建功能，支持大规模节点的无极缩放、随意平移和拖拽。
  
- **智能 Dagre 排版与分组优化**
  通过集成 `@dagrejs/dagre` 算法，应用支持**一键排序对齐**。所有的节点都会自动被分组纳入所属的“生育期框（Group box）”当中，不仅在框内实现了多层级计算与依赖梳理，更支持组级与组级宏观的拓扑层展示。并做了**特殊防重叠与防划线错位处理（几何水平通道展开与边界检测偏移）**以确保超多数量连线的呈现极度工整。
  
- **完整的动态/静态依赖控制支持（Smart Edges）**
  通过左侧面板的组件盘，你可以将具有不同时间特性的连线动态地插入连接口。支持精确捕捉和双击直接设定缓冲天数差（譬如：“0天”、“60天”）。
  
- **表单级全量字段编辑支持 (NodeEditDrawer)**
  支持直接双击任意存在（或动态添加）的节点调出配置抽屉（Drawer）。在抽屉中提供了所有 BTU 模板内必填子属性的新增、修改和预览支持，包括：
  - **时间窗口** 
  - **BTU 主题及条目** 
  - **准入条件** 
  - **纠偏信息** 

- **Smart ID 远程挂载集成 (API)**
  与业务大后台完全桥接。所有通过画板新生成的虚拟构件（包含拖入的新节点、新连接出的连线、乃至抽屉里新建的一个时间窗/条目）在本地注册前，都会立即发起跨域请求（被 Vite 代理），通过 `generateSmartId` 拿到具有唯一标识语义的 ID。

- **IO 一键式导入导出**
  允许你直接在文本面板黏贴/查阅规范化之后的结构化 JSON 数据，一键即席渲染到画布上或保存到云端。

## 🛠️ 技术栈与依赖

*   **框架核心**: Vue 3 (Composition API, `<script setup>`)
*   **工程化**: Vite
*   **图像渲染**: `@vue-flow/core`, `@vue-flow/background`, `@vue-flow/controls`
*   **排版算法**: `@dagrejs/dagre`
*   **HTTP 请求**: `axios` (配合 Proxy 重写请求头应对跨域问题)

## 📁 核心结构

```text
src/
├── api/
│   └── index.js               # Smart ID 后端通讯服务、ID 类型枚举映射
├── components/
│   ├── Toolbar.vue            # 顶部动作菜单栏
│   ├── IOPanel.vue            # 原生 Json 输入与导出显示底板
│   ├── Palette.vue            # 左侧操作盘（用于左侧拖拽实例化构件或单点查看节点简要信息）
│   ├── FlowCanvas.vue         # 位于核心的连线渲染器和异步组件通讯代理桥梁
│   └── NodeEditDrawer.vue     # 全套参数编辑与管理的高级侧边栏组件
├── store/
│   ├── flowStore.js           # 封装的应用级核心状态与全局响应式共享机制
│   └── flowActions.js         # 模型解析、JSON导入和组内序列化提取动作逻辑中心
├── utils/
│   └── layout.js              # Dagre 算法封装修补、处理并包装特殊重叠消除后的图形布局配置项信息
└── App.vue                    # 应用装配容器
```

## 🚀 启动与使用指南

### 环境依赖
请确保你的环境已经安装完整的 `Node.js` (建议 LTS 版，如 `v18+`)

### 启动流程
在仓库根目录中：

1. **安装包依赖**
   ```sh
   npm install
   ```
2. **启动本地调试开发服务器** (将在默认 5173 端口起用应用，包含热加载模块与自动跨域代理功能)
   ```sh
   npm run dev
   ```
3. **打包为静态生产环境内容**
   ```sh
   npm run build
   ```
   (打包后的文件全在默认的 `dist/` 文件夹下。)

## 💡 使用小贴士
1. **获取不到 ID/发红报错怎么办？**：本项目依赖服务端的生成器 API（通常是指向类似 `http://precisXXXX.XX.com/smartId/` ），因此在非前端调试本地机器的情况下，需要确保你运行所在的主机网络支持连接到该后台，或是正确配置好了你所在的线上 Nginx 反向代理拦截对应 `smartId` 请求路由。
2. **为什么线穿过盒子的问题被解决了？**：本应用内部设计并在 `src/utils/layout.js` 提供了一个独立的“**几何平铺边缘重叠消除算法**”。为了生效其对齐，你需要导入你的数据后点击首部的 **【一键排版】** 才能让应用根据节点位置和层级，把一簇平行关系线梳理错开从而不再相互覆盖。
